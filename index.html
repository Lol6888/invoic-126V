<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Onetwentysix Verse — Invoice Builder (A4 Print Fixed)</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&display=swap');

:root{
  --ink:#2b1a4a; --rule:#3b275f; --paper:#faf6f1; --sheet:#fdfaf7;
  --accent:#ff6f61; --circle:#efdccf; --paybg:#efe8dc; --payborder:#dccfbb;
  --tbl-bg:#f7f3ed; --tbl-border:#e4dbce; --tbl-zebra1:#fcfaf8; --tbl-zebra2:#f8f5f0;
  --brand:#2b1a4a;
}

/* ===== Base / Builder ===== */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; background:var(--paper);
  font-family:'Outfit',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  color:var(--ink); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  font-variant-numeric:tabular-nums; font-feature-settings:"tnum"1,"lnum"1;
}

.builder{max-width:980px; margin:18px auto 0; padding:14px}
.controls{background:#ffffffcc;border:1px solid #e7e1d8;border-radius:12px;padding:14px;box-shadow:0 6px 16px rgba(0,0,0,.06)}
.controls h3{margin:0 0 10px;font-size:18px;color:var(--brand)}
.grid{display:grid;gap:12px}
.grid.cols-3{grid-template-columns:1fr 1fr 1fr}
.grid.cols-2{grid-template-columns:1fr 1fr}
label{font-size:13px;font-weight:600}
input[type="text"],input[type="number"],input[type="date"],select,textarea{
  width:100%;padding:10px 12px;border:1px solid #e0d8cc;border-radius:10px;background:#fff;font:inherit;color:var(--ink)
}
textarea{resize:vertical;min-height:64px}
.small{font-size:12px;opacity:.7}
.row{display:flex;gap:10px;align-items:center}
button{appearance:none;border:none;cursor:pointer;border-radius:12px;padding:10px 16px;font-weight:700;background:var(--brand);color:#fff;box-shadow:0 6px 16px rgba(0,0,0,.08)}
button.secondary{background:#7c6a9f}
button.ghost{background:#fff;color:var(--brand);border:1px solid #d7cabc}

/* Items editor */
.item-row{display:grid;grid-template-columns:1.2fr .4fr .3fr .4fr auto;gap:8px;align-items:center}
.item-row .del{background:#fff;color:#c0392b;border:1px solid #f1d6d3}
.add-row{background:#fff;color:var(--brand);border:1px dashed #d7cabc}

/* ===== Invoice Preview ===== */
.invoice-wrapper{
  position:relative;max-width:820px;margin:18px auto 40px;background:var(--sheet);
  padding:60px 60px 44px;border-radius:16px;box-shadow:0 12px 40px rgba(0,0,0,.08);overflow:hidden;z-index:0
}
/* đảm bảo text nổi trên décor */
.invoice-header,.title,.info,.items-wrapper,.summary,.payment-box,.invoice-note{position:relative;z-index:2}

.decor{position:absolute;pointer-events:none}
.decor-circle{top:-140px;right:-140px;width:420px;height:420px;background:var(--circle);opacity:.65;border-radius:50%}
.decor-blob{top:128px;right:44px;width:112px;height:112px;background:var(--accent);border-radius:32% 68% 61% 39%/38% 31% 69% 62%;transform:rotate(22deg)}

.invoice-header{display:flex;justify-content:space-between;align-items:flex-start}
.logo-col{display:flex;align-items:center;gap:14px;min-width:0}
.logo{width:64px;height:64px;object-fit:contain;flex:0 0 64px;background:#fff;border-radius:8px}
.company-info{line-height:1.2;min-width:0}
.company-name{font-size:18px;font-weight:700;margin:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.tagline{font-size:13px;margin-top:2px;opacity:.8}
.social{text-align:right}
.social p{margin:.25rem 0 .5rem;font-size:14px;opacity:.9}
.icons{display:flex;gap:10px;justify-content:flex-end}
.ico{display:inline-grid;place-items:center;width:26px;height:26px;border:1.5px solid currentColor;border-radius:50%;color:var(--ink);text-decoration:none}
.ico svg{width:14px;height:14px}

.title{font-size:24px;font-weight:700;margin:36px 0 16px}
.info{display:grid;grid-template-columns:1.2fr .6fr .6fr;gap:24px;font-size:15px;margin-bottom:16px}
.info strong{display:block;margin-bottom:6px}

/* Table A+B */
.items-wrapper{background:var(--tbl-bg);border:1px solid var(--tbl-border);border-radius:10px;padding:16px 20px;margin-top:16px}
.items{width:100%;border-collapse:separate;border-spacing:0}
.items thead{border-bottom:2px solid var(--rule)}
.items th{padding:10px 8px;text-align:left;font-weight:700;letter-spacing:.2px}
.items td{padding:12px 8px;font-size:15px;border-bottom:1px solid var(--tbl-border)}
.items tbody tr:nth-child(odd){background:var(--tbl-zebra1)}
.items tbody tr:nth-child(even){background:var(--tbl-zebra2)}
.items tbody tr:last-child td{border-bottom:none}
.items th:nth-child(2),.items th:nth-child(3),.items th:nth-child(4),
.items td:nth-child(2),.items td:nth-child(3),.items td:nth-child(4){text-align:right}

.summary{margin-top:18px;font-size:16px;text-align:right;line-height:1.9}
.summary span{display:inline-block;width:110px;text-align:right;font-weight:600}
.summary .total{font-weight:800;font-size:18px}

.payment-box{margin-top:28px;padding:20px 22px;background:var(--paybg);border:1px solid var(--payborder);border-radius:14px}
.payment-box h3{margin:0 0 14px;font-size:18px;font-weight:800}
.payment-grid{display:grid;grid-template-columns:1.3fr .7fr;gap:22px;align-items:start}
.pay-col h4{margin:4px 0 10px;font-size:15px;font-weight:700}
.banklines{margin:0;display:grid;grid-template-columns:160px 1fr;gap:8px 12px;font-size:14px}
.banklines dt{font-weight:700}
.banklines dd{margin:0}
.qr .qr-wrap{display:grid;place-items:center;width:170px;height:170px;background:#fff;border:1px dashed var(--payborder);border-radius:12px;overflow:hidden}
.qr .qr-wrap img{width:100%;height:100%;object-fit:contain}
.note{margin:.5rem 0 0;font-size:12px;opacity:.8}

.invoice-note{margin-top:40px;text-align:center;border-top:1px solid #e4dbce;padding-top:20px;color:var(--ink)}
.invoice-note .note-line{font-size:15px;font-weight:600;margin-bottom:6px}
.invoice-note .wish-line{font-size:14px;opacity:.8;font-style:italic}

/* Responsive */
/* ===== Print: luôn khít 1 trang A4 ===== */
@page{ size: A4; margin: 0; }

@media print{
  /* tuỳ chỉnh mức thu nhỏ: 0.92–0.97. Nếu còn tràn, hạ chút nữa */
  :root{ --p: .94; }

  body{
    background:#fff;
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }

  /* Ẩn phần nhập liệu */
  .builder{ display:none !important; }

  /* Thu nhỏ toàn bộ invoice theo hệ số --p */
  .invoice-wrapper{
    /* tăng kích thước “thực” rồi scale xuống để vừa A4 */
    width: calc(210mm / var(--p));
    min-height: calc(297mm / var(--p));
    margin: 0;
    border-radius: 0;
    box-shadow: none;
    padding: 18mm 16mm 16mm;   /* lề thực tế của trang */
    transform: scale(var(--p));
    transform-origin: top left;
    overflow: hidden;
    page-break-after: always;
    page-break-inside: avoid;
  }

  /* Điều chỉnh vị trí décor để không đè chữ */
  .decor-circle{
    top: -52mm; right: -52mm;
    width: 160mm; height: 160mm;
  }
  .decor-blob{ top: 38mm; right: 22mm; }

  /* Ngăn bị cắt đôi giữa trang */
  .info, .items-wrapper, .summary, .payment-box, .invoice-note,
  .items, .items tbody, .items tr{
    break-inside: avoid;
    page-break-inside: avoid;
  }
}

</style>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<!-- ===== Builder ===== -->
<div class="builder">
  <div class="controls">
    <h3>Invoice Builder</h3>

    <div class="grid cols-3">
      <div><label>Company Name</label><input id="inpCompany" type="text" value="Onetwentysix Verse CO., LTD"></div>
      <div><label>Tagline</label><input id="inpTagline" type="text" value="Brand &amp; Marketing Solutions"></div>
      <div><label>Logo (optional)</label><input id="inpLogo" type="file" accept="image/*"><div class="small">If empty, default logo path will be used.</div></div>
    </div>

    <div class="grid cols-3" style="margin-top:10px">
      <div><label>Billing to (Name)</label><input id="inpBillName" type="text" value="Name surname"></div>
      <div><label>Billing Address</label><input id="inpBillAddr" type="text" value="Street 123. California"></div>
      <div><label>Username (top-right)</label><input id="inpUsername" type="text" value="Onetwentysix Verse"></div>
    </div>

    <div class="grid cols-3" style="margin-top:10px">
      <div><label>Invoice #</label><input id="inpNumber" type="text" value="#0001"></div>
      <div><label>Date</label><input id="inpDate" type="date" value="2024-02-13"></div>
      <div><label>Currency</label>
        <select id="inpCurrency">
          <option value="USD" selected>USD ($)</option>
          <option value="VND">VND (₫)</option>
          <option value="GBP">GBP (£)</option>
          <option value="AUD">AUD (A$)</option>
        </select>
      </div>
    </div>

    <div style="margin-top:10px">
      <label>Items</label>
      <div id="itemsEditor"></div>
      <button class="add-row" id="btnAddRow">+ Add item</button>
    </div>

    <div class="grid cols-3" style="margin-top:10px">
      <div><label>VAT (%)</label><input id="inpVAT" type="number" value="10" min="0" step="0.1"></div>
      <div><label>Note (footer line 1)</label><input id="inpNote1" type="text" value="Thank you for choosing Onetwentysix Verse as your creative partner."></div>
      <div><label>Wish (footer line 2)</label><input id="inpNote2" type="text" value="We wish you continued success and growth — let’s build something remarkable together!"></div>
    </div>

    <div class="grid cols-2" style="margin-top:10px">
      <div>
        <label>Bank (fixed)</label>
        <textarea readonly>Beneficiary Name: PHAN NGOC THINH
Account Number: 0161001689119
Bank: Vietcombank – Joint Stock Commercial Bank for Foreign Trade of Vietnam
SWIFT/BIC: BFTVVNVX</textarea>
      </div>
      <div>
  <label>PayPal QR</label>
  <div style="display:flex; align-items:center; gap:8px; margin-bottom:6px;">
    <input type="checkbox" id="showQR" checked>
    <label for="showQR" style="margin:0; font-weight:600;">Show QR on invoice</label>
  </div>
  <input id="inpQR" type="file" accept="image/*">
  <div class="small">If empty, default <code>paypal-qr.png</code> will be used.</div>
</div>

    </div>

    <div class="row" style="margin-top:12px;justify-content:flex-end">
<button id="btnPNG">Download PNG</button>
      <button id="btnPreview">Preview</button>
      <button class="secondary" id="btnRecalc">Recalculate</button>
      <button class="ghost" onclick="window.print()">Download PDF</button>
    </div>
  </div>
</div>

<!-- ===== Invoice ===== -->
<div id="invoice" class="invoice-wrapper">
  <div class="decor decor-circle"></div>
  <div class="decor decor-blob"></div>

  <header class="invoice-header">
    <div class="logo-col">
      <img id="logo" src="logo300x300.png" alt="logo" class="logo">
      <div class="company-info">
        <h1 id="companyName" class="company-name">Onetwentysix Verse CO., LTD</h1>
        <p id="companyTagline" class="tagline">Brand &amp; Marketing Solutions</p>
      </div>
    </div>
    <div class="social">
      <p id="username">@username</p>
      <div class="icons" aria-label="social links">
        <a href="#" aria-label="Facebook" class="ico">
          <svg viewBox="0 0 24 24"><path d="M22 12.07C22 6.49 17.52 2 11.93 2S2 6.49 2 12.07c0 5.02 3.66 9.19 8.44 9.98v-7.06H7.9v-2.92h2.54V9.41c0-2.5 1.49-3.88 3.77-3.88 1.09 0 2.22.2 2.22.2v2.44h-1.25c-1.23 0-1.61.77-1.61 1.56v1.87h2.74l-.44 2.92h-2.3v7.06C18.34 21.26 22 17.09 22 12.07z" fill="currentColor"/></svg>
        </a>
        <a href="#" aria-label="Instagram" class="ico">
          <svg viewBox="0 0 24 24"><path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm10 2H7a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3zm-5 3.5a5.5 5.5 0 1 1 0 11.001 5.5 5.5 0 0 1 0-11zM19 6.5a1 1 0 1 1-2.001-.002A1 1 0 0 1 19 6.5z" fill="currentColor"/></svg>
        </a>
        <a href="#" aria-label="Twitter" class="ico">
          <svg viewBox="0 0 24 24"><path d="M22.46 6c-.77.34-1.6.57-2.46.68a4.23 4.23 0 0 0 1.85-2.34 8.42 8.42 0 0 1-2.67 1.02 4.21 4.21 0 0 0-7.29 3.84A11.95 11.95 0 0 1 3.15 4.7a4.2 4.2 0 0 0 1.3 5.62 4.16 4.16 0 0 1-1.9-.52v.05a4.22 4.22 0 0 0 3.38 4.13c-.46.12-.94.18-1.44.07a4.23 4.23 0 0 0 3.94 2.93A8.45 8.45 0 0 1 2 19.55 11.93 11.93 0 0 0 8.29 21c7.55 0 11.68-6.26 11.68-11.68 0-.18 0-.35-.01-.53A8.34 8.34 0 0 0 22.46 6z" fill="currentColor"/></svg>
        </a>
      </div>
    </div>
  </header>

  <h2 class="title">Invoice</h2>

  <section class="info">
    <div>
      <strong>Billing to:</strong>
      <p id="billTo">Name surname<br>Street 123. California</p>
    </div>
    <div><p><strong>Invoice number</strong><br><span id="invNumber">#0001</span></p></div>
    <div><p><strong>Date</strong><br><span id="invDate">February 13, 2024</span></p></div>
  </section>

  <div class="items-wrapper">
    <table class="items">
      <colgroup>
        <col style="width:55%"><col style="width:15%"><col style="width:10%"><col style="width:20%">
      </colgroup>
      <thead><tr><th>Description</th><th>Price</th><th>Qty.</th><th>Total</th></tr></thead>
      <tbody id="itemsBody"></tbody>
    </table>
  </div>

  <section class="summary">
    <p>Subtotal <span id="subtotal">$0.00</span></p>
    <p>Tax <span id="tax">$0.00</span></p>
    <p class="total">Total <span id="grand">$0.00</span></p>
  </section>

  <section class="payment-box">
    <h3>Payment Information</h3>
    <div class="payment-grid">
      <div class="pay-col">
        <h4>Bank Transfer (Vietcombank)</h4>
        <dl class="banklines">
          <dt>Beneficiary Name</dt><dd>PHAN NGOC THINH</dd>
          <dt>Account Number</dt><dd>0161001689119</dd>
          <dt>Bank</dt><dd>Vietcombank – Joint Stock Commercial Bank for Foreign Trade of Vietnam</dd>
          <dt>SWIFT/BIC</dt><dd>BFTVVNVX</dd>
        </dl>
      </div>
      <div class="pay-col qr">
  <h4>PayPal (Scan to Pay)</h4>
  <div class="qr-wrap"><img id="qrImg" src="paypal-qr.png" alt="PayPal QR"></div>
  <p class="note">Open PayPal app or camera to scan QR.</p>
</div>

    </div>
  </section>

  <footer class="invoice-note">
    <p class="note-line" id="note1">Thank you for choosing <strong>Onetwentysix Verse</strong> as your creative partner.</p>
    <p class="wish-line" id="note2">We wish you continued success and growth — let’s build something remarkable together!</p>
  </footer>
</div>

<script>
const $ = s=>document.querySelector(s);
const formatMoney = (num, currency) => {
  const map={USD:{style:'currency',currency:'USD'},VND:{style:'currency',currency:'VND',minimumFractionDigits:0},GBP:{style:'currency',currency:'GBP'},AUD:{style:'currency',currency:'AUD'}};
  const opt=map[currency]||map.USD; return new Intl.NumberFormat('en-US',opt).format(num||0);
};
const parseNum=v=>isNaN(+v)?0:+v;

let items=[{desc:'Lorem ipsum dolor',price:0,qty:1}];

const itemsEditor=$('#itemsEditor');
function renderItemsEditor(){
  itemsEditor.innerHTML='';
  items.forEach((it,idx)=>{
    const row=document.createElement('div');
    row.className='item-row';
    row.innerHTML=`
      <input data-k="desc" data-i="${idx}" type="text" placeholder="Description" value="${it.desc}">
      <input data-k="price" data-i="${idx}" type="number" min="0" step="0.01" placeholder="Price" value="${it.price}">
      <input data-k="qty" data-i="${idx}" type="number" min="0" step="1" placeholder="Qty" value="${it.qty}">
      <input data-k="total" type="text" value="" disabled placeholder="Auto">
      <button class="del" data-del="${idx}">Delete</button>`;
    itemsEditor.appendChild(row);
  });
  itemsEditor.querySelectorAll('input[data-k]').forEach(inp=>{
    inp.addEventListener('input',()=>{
      const i=+inp.dataset.i,k=inp.dataset.k;
      if(k==='desc') items[i].desc=inp.value;
      if(k==='price') items[i].price=parseNum(inp.value);
      if(k==='qty') items[i].qty=parseNum(inp.value);
      recalc();
    });
  });
  itemsEditor.querySelectorAll('button[data-del]').forEach(btn=>{
    btn.onclick=()=>{items.splice(+btn.dataset.del,1); renderItemsEditor(); recalc();};
  });
  const cur=$('#inpCurrency').value;
  itemsEditor.querySelectorAll('.item-row').forEach((row,i)=>{
    const t=(items[i].price||0)*(items[i].qty||0);
    row.querySelector('input[disabled]').value=formatMoney(t,cur);
  });
}
$('#btnAddRow').onclick=()=>{items.push({desc:'',price:0,qty:1}); renderItemsEditor();};

function applyFields(){
  $('#companyName').textContent=$('#inpCompany').value||'Onetwentysix Verse CO., LTD';
  $('#companyTagline').textContent=$('#inpTagline').value||'';
  $('#username').textContent=$('#inpUsername').value||'';
  $('#billTo').innerHTML=($('#inpBillName').value||'')+'<br>'+($('#inpBillAddr').value||'');
  $('#invNumber').textContent=$('#inpNumber').value||'#0001';
  const d=$('#inpDate').value; if(d){const dt=new Date(d); $('#invDate').textContent=dt.toLocaleDateString('en-US',{year:'numeric',month:'long',day:'numeric'});}
  $('#note1').innerHTML=($('#inpNote1').value||'').replace(/\n/g,'<br>');
  $('#note2').innerHTML=($('#inpNote2').value||'').replace(/\n/g,'<br>');
}

function recalc(){
  const cur=$('#inpCurrency').value;
  const tbody=$('#itemsBody'); tbody.innerHTML='';
  let subtotal=0;
  items.forEach(it=>{
    const line=(it.price||0)*(it.qty||0); subtotal+=line;
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${it.desc||''}</td><td>${formatMoney(it.price||0,cur)}</td><td>${it.qty||0}</td><td>${formatMoney(line,cur)}</td>`;
    tbody.appendChild(tr);
  });
  const vat=parseNum($('#inpVAT').value||0);
  const tax=subtotal*(vat/100); const grand=subtotal+tax;
  $('#subtotal').textContent=formatMoney(subtotal,cur);
  $('#tax').textContent=formatMoney(tax,cur);
  $('#grand').textContent=formatMoney(grand,cur);
  
}

/* uploads */
$('#inpLogo').addEventListener('change',e=>{
  const f=e.target.files[0]; if(!f) return; $('#logo').src=URL.createObjectURL(f);
});
$('#inpQR').addEventListener('change',e=>{
  const f=e.target.files[0]; if(!f) return; $('#qrImg').src=URL.createObjectURL(f);
});

/* live bindings */
['inpCompany','inpTagline','inpUsername','inpBillName','inpBillAddr','inpNumber','inpDate','inpNote1','inpNote2','inpCurrency','inpVAT']
.forEach(id=>document.getElementById(id).addEventListener('input',()=>{applyFields(); recalc();}));

$('#btnPreview').onclick=()=>{applyFields(); recalc(); document.getElementById('invoice').scrollIntoView({behavior:'smooth'});};
$('#btnRecalc').onclick=()=>{applyFields(); recalc();};

/* init */
renderItemsEditor(); applyFields(); recalc();
/* --- PayPal QR logic --- */
  /* --- PayPal QR logic --- */
window.addEventListener('DOMContentLoaded', () => {
  const qrImg = document.getElementById('qrImg');
  const chkQR = document.getElementById('showQR');
  const noteQR = document.querySelector('.qr .note');
  const inpQR = document.getElementById('inpQR');

  // kiểm tra đủ phần tử mới chạy
  if (!qrImg || !chkQR || !inpQR) return;

  // mặc định hiển thị QR mặc định
  qrImg.src = 'paypal-qr.png';
  qrImg.parentElement.style.display = 'grid';
  noteQR.style.display = 'block';

  // toggle hiển thị
  chkQR.addEventListener('change', () => {
    const show = chkQR.checked;
    qrImg.parentElement.style.display = show ? 'grid' : 'none';
    noteQR.style.display = show ? 'block' : 'none';
  });

  // upload QR mới
  inpQR.addEventListener('change', e => {
    const file = e.target.files[0];
    if (file) {
      const url = URL.createObjectURL(file);
      qrImg.src = url;
      chkQR.checked = true;
      qrImg.parentElement.style.display = 'grid';
      noteQR.style.display = 'block';
    }
  });
});
/* --- Download as PNG --- */
document.getElementById('btnPNG').addEventListener('click', async () => {
  const invoice = document.getElementById('invoice');
  // Ẩn hiệu ứng, scroll để chụp gọn
  invoice.scrollIntoView();

  // Dùng html2canvas để render
  const canvas = await html2canvas(invoice, {
    scale: 2,              // độ nét cao hơn (2x)
    useCORS: true,         // cho phép ảnh ngoại vi
    backgroundColor: '#fff'
  });

  const link = document.createElement('a');
  link.download = 'invoice.png';
  link.href = canvas.toDataURL('image/png');
  link.click();
});

</script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

</body>
</html>
